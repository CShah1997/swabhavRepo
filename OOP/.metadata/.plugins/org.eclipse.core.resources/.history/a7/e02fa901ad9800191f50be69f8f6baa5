package com.techlabs.game;

import com.techlabs.exception.CellIsAlredyMarkedException;

public class Game {
	
	private Board board;
	private GameState status=GameState.PLAYING;
	private ResultAnalyzer analyzer;
	private Player p1,p2,currentPlayer;
	private int playerMoveCount=1;
	
	

	public Game(Player player1, Player player2) {
		this.p1=player1;
		this.p2=player2;
		board=new Board();
		analyzer=new ResultAnalyzer(board);
		currentPlayer=p1;
	}
	
	public void makePlayerMove(int row,int column) throws CellIsAlredyMarkedException
	{
		board.putMarkOnCell(currentPlayer.getMark(), row, column);
	}
	
	public GameState play(int row,int column)
	{
		currentPlayer=getCurrentPlayer();
		makePlayerMove(row, column);
		if(analyzer.hasWon(Marker.X))
		{
			status=GameState.PLAYER_X_WON;
		}
		if(analyzer.hasWon(Marker.O))
		{
			status=GameState.PLAYER_O_WON;
		}
		if(analyzer.isDraw())
		{
			status=GameState.DRAW;
		}
		return status;
		
	}
	
	private Player getCurrentPlayer() 
	{
		if(playerMoveCount%2==0)
		{
			return p2;
		}
		return p1;
	}

	public void showBoard()
	{
		for(int row=0;row<board.getBoardSize();row++)
		{
			for(int column=0;column<board.getBoardSize();column++)
			{
				System.out.println(board.getMarkOnCell(row, column) +"\t"+ board.getMarkOnCell(row++, column++) +"\t"+ board.getMarkOnCell(row++, column++));
			}
		}
	}
	
	public int getMoveCount()
	{
		return playerMoveCount;
	}
	

}
